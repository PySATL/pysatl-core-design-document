\chapter{Ключевые требования, определяющие архитектуру}

\section{Сценарии использования системы}

\todo[color=green!40, inline]{todo; see \href{https://github.com/PySATL/pysatl-core-design-document/issues/9}{ISSUE}}

\section{Технические ограничения и качественные требования}
\subsection{Технические ограничения}
В данном разделе перечислены внешние технические ограничения, влияющие на архитектуру и реализацию системы. Эти ограничения задаются проектом PySATL или внешними условиями и не подлежат изменению в рамках проектирования ядра.

\begin{itemize}[compact]
    \item \textit{Язык реализации}: система должна предоставлять основной пользовательский интерфейс на языке Python версии 3.x. Допускается использование других языков программирования (например, C/C++) во внутренней реализации с целью оптимизации вычислений, при условии полной прозрачности интерфейса для Python-пользователя.
    \item \textit{Лицензирование}: система должна распространяться под MIT-лицензией. Использование копилефт-лицензий (например, GPL) запрещено.
    \item \textit{Кроссплатформенность}: система должна работать на основных операционных системах (Linux, macOS, Windows) без необходимости установки платформозависимых компонентов или привязки к конкретной среде исполнения.
    \item \textit{Вычислительные ограничения}: система не должна требовать наличия GPU или специализированного оборудования. Все вычисления должны корректно выполняться на CPU без дополнительных зависимостей. 
\end{itemize}

\subsection{Качественные характеристики системы}

Данный раздел описывает нефункциональные требования, оказывающие влияние на архитектуру, проектные решения и организацию компонентов системы.

\subsubsection{Расширяемость}

Система должна обеспечивать возможность добавления новых распределений, семейств и преобразований без необходимости изменения существующего кода. Расширение должно происходить через зарегистрированные интерфейсы или стандартные механизмы расширения Python.

\subsubsection{Модульность и интерфейсы:}

Система должна быть реализована в виде набора Python-модулей с чётко определёнными публичными интерфейсами. Модули должны быть слабо связаны друг с другом, а взаимодействие между ними должно происходить исключительно через открытые контракты. Пакет в целом должен также иметь публичный интерфейс для взаимодействия с пользователем и другими подсистемами PySATL. Внутренние и внешние интерфейсы могут быть различны.

\subsubsection{Совместимость}

Система должна быть совместима с остальными компонентами PySATL. Переход на новое ядро должен быть максимально прозрачным для пользователя и не требовать значительных изменений в существующем коде или логике пакетов, использующих ядро.

\subsubsection{Тестируемость}

Архитектура должна способствовать покрытию тестами ключевой функциональности системы. Для стадии прототипа допускается ограниченное покрытие, однако оно должно быть достаточным для выявления ошибок при изменении поведения или интерфейсов.

\subsubsection{Устойчивость к ошибкам}

Система должна быть устойчива к некорректным пользовательским данным и иметь механизм информирования об ошибках. Поведение при ошибках должно быть контролируемым и предсказуемым, включая диагностику нарушений интерфейсов, типов и других контрактов.

\subsubsection{Документируемость и визуализация:}
Архитектура модулей, их интерфейсы и взаимосвязи должны быть представлены в виде UML-диаграмм и сопровождаться соответствующей технической документацией. Диаграммы должны отражать как общую структуру системы, так и реализацию ключевых компонентов и связей.


\section{Ключевые функциональные требования}
В данном разделе изложены функциональные требования к системе, определяющие её основную вычислительную модель, интерфейсы и возможности расширения. Эти требования отражают ожидаемое поведение ядра и набор поддерживаемых операций. Можно выделить следующие группы требований

\begin{itemize}[compact]
    \item[(ГФТ1)] \textit{Определение распределения}: каждое распределение должно быть определено посредством как минимум одной функциональной характеристики (например, функция плотности или функция распределения), поддерживать генерацию выборки и вычисление логарифма правдоподобия. Распределение должно быть связано с типом случайной величины (дискретной или непрерывной) и типом значений выборки(многомерной или одномерной).
    \item[(ГФТ2)] \textit{Функциональные и числовые характеристики}: система должна поддерживать вычисление основных и дополнительных характеристик распределений, включая возможность их  добавления пользователем, а также предоставлять гарантии корректности вычислений.
    \item[(ГФТ3)] \textit{Семплирование распределений}. Для каждого распределения должна быть доступна генерация выборки. При этом, пользователь должен иметь возможность добавлять свои способы семплирования и настраивать используемый способ семплирования. Система также должна предоставлять механизмы проверки качества семплирования.
    \item[(ГФТ4)] \textit{Поддержка основных распределений}: система должна предоставлять встроенную поддержку наиболее распространённых распределений (нормальное, экспоненциальное, биномиальное и др.), а также предусматривать механизм регистрации пользовательских распределений.
    \item[(ГФТ5)] \textit{Работа с семействами распределений}: система должна поддерживать задание семейств распределений, определяемых через параметрические пространства. Необходимо обеспечить возможность описания связей между семействами, включая асимптотику и граничные переходы (например, предельные случаи распределений при изменении параметров). Поддержка пользовательских семейств и добавления новых связей обязательна.

    \item[(ГФТ6)] \textit{Преобразования распределений}: система должна поддерживать стандартные операции преобразования распределений, включая арифметические операции, функциональные отображения, свёртки, смеси и т.п. Должна быть предусмотрена возможность компоновки и каскадирования таких преобразований.
\end{itemize}


\subsection{Требования к числовым и функциональным характеристикам}

Под корректным вычислением числовой или функциональной характеристики заданного распределения подразумевается следующее поведение системы:
\begin{enumerate}[compact]
    \item В случае если значение характеристики определено и \textit{всегда} является числом, оно должно вычисляться с предопределенной гарантией точности (например, в виде верхней оценки на относительную погрешность);  
    \item В случае если значение характеристики \textit{равно} $\pm \infty$, должно выдаваться значение специального типа, представляющего собой абстракцию бесконечности;
    \item В случае если значение характеристики \textit{неопределенно}, система должна выдать объект типа NaN. Опционально должно выдаваться предупреждение о том что соответствующее значение не является числом или $\pm\infty$.
    \item В случае если значение характеристики \textit{может быть равно $\pm \infty$ или может быть неопределенно}, и заранее это невозможно проверить, необходимо предоставлять набор условий, при выполнений которых, с близкой к 1 вероятностью, значение можно считать вычисленным корректно, в смысле п.1;
\end{enumerate}

\textbf{Полнота:}
\begin{itemize}[compact]
    \item Для любого распределения должно быть доступно вычисление всех характеристик моментного/квантильного/информационного типа приведенных в глоссарии;
    \item Для любого распределения должно быть доступно вычисление всех функциональных характеристик (если они существуют для данного распределения) приведенных в глоссарии.
\end{itemize}

\textbf{Гибкость и конфигурируемость:}
\begin{itemize}[compact]
    \item При наличии нескольких алгоритмов для расчета числовой/функциональной характеристики данного распределения, должен быть определен алгоритм, который используется по умолчанию;
    \item При наличии нескольких алгоритмов для расчета числовой/функциональной характеристики пользователь должен иметь возможность указать, какой алгоритм использовать.
\end{itemize}

\textbf{Расширяемость:}
\begin{itemize}[compact]
    \item Пользователь должен иметь возможность добавлять свои собственные алгоритмы вычисления для уже существующих функциональных/числовых характеристик;
    \item Пользователь должен иметь возможность добавлять собственные числовые характеристики. В случае если числовая характеристика определена не для всех распределений, пользователь должен иметь возможность явно указать для какого класса распределений определена характеристика;
    \item Пользователь должен иметь возможность добавлять собственные функциональные характеристики. В случае если функциональная характеристика определена не для всех распределений, пользователь должен иметь возможность явно указать для какого класса распределений определена характеристика.
\end{itemize}


\subsection{Требования к семействам распределений}
\begin{itemize}[compact]
    \item Для любого семейства распределений должна быть возможность создать новое семейство распределений, получаемое из исходного частичной подстановкой значений параметров;
    \item Для любого семейства распределений должна быть определена каноническая параметризация;
    \item Для любого семейства распределений должна быть возможность добавления новой параметризации. При добавлении новой параметризации, пользователь должен указать как параметры добавляемой параметризации выражаются через каноническую параметризацию и наоборот;
    \item Над семействами необходимо уметь производить операции образования смесей: непрерывных и дискретных;
    \item Должна быть возможность указать как представители семейства взаимодействуют с представителями других семейств при выполнении операций.
\end{itemize}

\subsection{Требования к операциям над распределениями}
\begin{itemize}[compact]
    \item Для одномерных непрерывных распределений должны быть доступны операции описанные в параграфе «Преобразования распределений» в глоссарии;
    \item При наличии нескольких способов вычисления операции, должен быть определён способ вычисления по умолчанию.
\end{itemize}

\subsection{Требования к генерации выборок}
\begin{itemize}[compact]
    \item Для любого распределения, за исключением относящихся к распределениям геометрических примитивов, должна быть возможность генерации выборок;
    \item При создании пользовательского распределения, система должна предоставлять методы для генерации выборок без необходимости реализовывать алгоритмы генерации;
    \item При наличии нескольких алгоритмов генерации выборок, пользователь должен иметь возможность выбирать алгоритм;
    \item Если алгоритм генерации выборок имеет параметры, то пользователь должен уметь настраивать эти параметры. К числу параметров также относится используемый источник случайных или псевдослучайных чисел.
\end{itemize}

